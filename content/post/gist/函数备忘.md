---
author: "wuxingzhong"
title: "函数备忘"
date: 2019-10-11T17:10:46+08:00
draft: false
tags: [""]
categories:  [""]
image: ""
banner: ""
comments: true     # set false to hide Disqus comments
share: true        # set false to share buttons
menu: ""           # set "main" to add this content to the main menu
---


## 获取key-value

```
strtok
```

## gist

将结构体映射到0地址,计算成员偏移量

```c
 (int)&(((TYPE*)0)->MEMBER )
```

将结构体映射到0地址,计算成员占用大小

```c
sizeof(((TYPE*)0)->MEMBER ) )
```

符号转字符串

```c
#define STR(s) #s
```

字符串拼接

```c
#define STRCAT(a,b) a##b

#define STRCAT(a,b) #a"."#b
```

达夫设备

```c

// duff's device  设备
int main()
{
    int count = 0;
    int val   = 0;
    printf("输入循环次数:\n");
    scanf("%d", &val);

    int n = val / 10;
    switch( val % 10 )
    {
        case 0:
        while( n-- >  0 )
        {
                   count++;  printf("%d\n", count);
            case 9:count++;  printf("%d\n", count);
            case 8:count++;  printf("%d\n", count);
            case 7:count++;  printf("%d\n", count);
            case 6:count++;  printf("%d\n", count);
            case 5:count++;  printf("%d\n", count);
            case 4:count++;  printf("%d\n", count);
            case 3:count++;  printf("%d\n", count);
            case 2:count++;  printf("%d\n", count);
            case 1:count++;  printf("%d\n", count);
       };
    }
    return 0;
}

```

## alarm

```c
#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>
#include <signal.h>
void handler(int sig)
{
    printf("get a sig,num is %d\n", sig );
    exit(0) ;
}

int main(void)
{
	int counter;
	signal(SIGALRM,handler);
	alarm(1);
	for(counter=0; 1; counter++)
        printf("counter=%d \n", counter);
	return 0;
}
```

## inotify

```c
#include <iostream>  
#include <sys/types.h>  
#include <sys/stat.h>  
#include <sys/wait.h>  
#include <fcntl.h>  
#include <unistd.h>  
#include <stdlib.h>  
#include <stdio.h>  
#include <sys/inotify.h>  
using namespace std;  
  
void watch_inotify(void)  
{  
    int fd = 0;  
    char data[255] = {0};  
    int num = 0;  
  
    fd = inotify_init();//初始化fd  
    inotify_add_watch(fd, "lt", IN_OPEN);//监听文件是否打开  
    num = read(fd, data, 255);//没打开，那么就会阻塞  
    cout << num << endl;//如果打开，那么会继续跑到这里  
}  
int main()  
{  
    watch_inotify();  
    return 0;  
}  
```
